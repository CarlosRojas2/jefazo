events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    sendfile on;
    keepalive_timeout 65;

    server {
        # 1. PUERTO PÚBLICO: Escucha en el puerto 8080 (el que Railway expone)
        listen 8080;
        
        # 2. RAÍZ DEL PROYECTO: Apunta al directorio público de Laravel
        root /var/www/public;
        
        index index.php index.html index.htm;

        # 3. CONTROLADOR LARAVEL: Envía todas las peticiones a index.php
        location / {
            # Si el archivo/directorio no existe, usa index.php como controlador
            try_files $uri $uri/ /index.php?$query_string;
        }

        # 4. PASO A PHP-FPM: Configuración para procesar archivos PHP
        location ~ \.php$ {
            # Deshabilita el manejo de archivos que no sean PHP
            try_files $uri =404;
            
            # ¡CRUCIAL! Pasa la solicitud al puerto donde PHP-FPM está escuchando
            fastcgi_pass 127.0.0.1:9000;
            
            # Directorio del script PHP
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
            
            include fastcgi_params;
        }

        # 5. SEGURIDAD: Denegar acceso a archivos ocultos (opcional pero recomendado)
        location ~ /\.ht {
            deny all;
        }
    }
}